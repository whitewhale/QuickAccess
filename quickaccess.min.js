(function($){$.fn.extend({quickaccess:function(options){this.each(function(){var self=$(this),qa={},s=$.extend({links:'.qa_links a',results:null,forceSelect:true,onSubmit:function(e,selected){if(selected.length){e.preventDefault();window.location=selected.eq(0).find('a').attr('href');}},maxResults:10,placeholder:null,tooMany:'Keep typing...',noneFound:'No matches found.',focus:false,sort:false,removeDuplicates:false},options);if(self.is('input[type=text],textarea'))qa.search=self;else qa.search=$('<input type="text" class="qa_search_query"/>').prependTo(self);if(s.placeholder)qa.search.attr('placeholder',s.placeholder);if(s.results)qa.results=$(s.results).eq(0);else qa.results=$('<div class="qa_results"></div>').insertAfter(qa.search);qa.results.addClass('qa_blur');qa.message=$('<div class="qa_message"></div>').appendTo(qa.results).hide();var toSpace=new RegExp(/[,\-_\s&\/\\]+/g),toRemove=new RegExp(/[^a-zA-Z 0-9]+/g);if(typeof s.links=='string'){qa.categories=[{selector:s.links}];}else{qa.categories=s.links;}
$.each(qa.categories,function(index,category){qa.categories[index].results=$('<div class="qa_category'+index+' qa_category'+(category.className?' '+category.className:'')+'">'+(category.title?'<div class="qa_category_title">'+category.title+'</div>':'')+'</div>').appendTo(qa.results);qa.categories[index].results_list=$('<ul class="qa_results_list"><li></li></ul>').appendTo(qa.categories[index].results);qa.categories[index].links=new Array();$(category.selector).each(function(){qa.categories[index].links.push({title:$(this).attr('title')?$(this).attr('title'):$(this).text(),keywords:$(this).attr('title')?($(this).attr('title')).toLowerCase().replace('&amp;','and').replace(toSpace,' ').replace(toRemove,''):(this.innerHTML).toLowerCase().replace('&amp;','and').replace(toSpace,' ').replace(toRemove,''),href:$(this).attr('href'),category:index});});if(s.sort)qa.categories[index].links.sort(function(a,b){var la=a.title.toLowerCase(),lb=b.title.toLowerCase();return(la==lb?0:(la>lb?1:-1));});qa.categories[index].matches=qa.categories[index].links;});qa.category_divs=qa.results.find('.qa_category');qa.results_lists=qa.results.find('.qa_results_list');qa.results_items=$([]);qa.search.attr('autocomplete','off').keyup(function(){var raw=$(this).val(),query=$.trim(raw.toLowerCase().replace(toSpace,' ').replace(toRemove,'')),subquery;if(query==qa.lastquery)return;if(!query.length){qa.lastquery='';qa.results_lists.html('<li></li>');qa.results.addClass('qa_noquery');return;}else qa.results.removeClass('qa_noquery');if(!qa.lastquery||query.indexOf(qa.lastquery)!=0){$.each(qa.categories,function(index){qa.categories[index].matches=qa.categories[index].links;});subquery=query;}else subquery=query.substring(query.lastIndexOf(' ')+1,query.length);qa.lastquery=query;var count=0;$.each(subquery.split(' '),function(){var search=this;$.each(qa.categories,function(index){qa.categories[index].matches=$.grep(qa.categories[index].matches,function(item){return(' '+item.keywords).indexOf(' '+search)>=0;});count+=qa.categories[index].matches.length;});});var query_exp=new RegExp('(\\b'+raw.replace(toRemove,'.').replace(/\s/g,'|\\b')+')','ig');qa.message.empty().hide();qa.results_lists.empty();qa.category_divs.removeClass('qa_nonefound');qa.results.removeClass('qa_toomany').removeClass('qa_nonefound');if(count>s.maxResults)qa.message.html(s.tooMany).show().parent().addClass('qa_toomany');else if(count==0){qa.message.html(s.noneFound).show().parent().addClass('qa_nonefound');if(qa.categories.length>1)qa.results_lists.html('<li class="qa_message">'+s.noneFound+'</li>').parent().addClass('qa_nonefound');}else{$.each(qa.categories,function(index){if(!qa.categories[index].matches.length)qa.categories[index].results_list.html('<li class="qa_message">'+s.noneFound+'</li>').parent().addClass('qa_nonefound');else{$.each(qa.categories[index].matches,function(i,item){if(!s.removeDuplicates||!qa.categories[index].results_list.find('a').filter(function(){return $(this).attr('href')==item.href;}).length){qa.categories[index].results_list.append('<li><a href="'+item.href+'">'+(' '+item.title).replace(query_exp,'<span class="qa_highlight">$1</span>')+'</a></li>');}});}});qa.results_items=qa.results.find('.qa_results_list li:not(.qa_message)');if(s.forceSelect)qa.results_items.eq(0).addClass('qa_selected');}}).keydown(function(e){switch(e.keyCode){case 38:e.preventDefault();var selected=qa.results.find('.qa_selected'),index=qa.results_items.index(selected);selected.removeClass('qa_selected');if(index>0)qa.results_items.eq(index-1).addClass('qa_selected');else if(s.forceSelect)qa.results_items.eq(qa.results_items.length-1).addClass('qa_selected');break;case 40:e.preventDefault();var selected=qa.results.find('.qa_selected'),index=qa.results_items.index(selected);selected.removeClass('qa_selected');if(index<qa.results_items.length-1)qa.results_items.eq(index+1).addClass('qa_selected');else if(s.forceSelect)qa.results_items.eq(0).addClass('qa_selected');break;case 13:var selected=qa.results.find('.qa_selected');s.onSubmit.apply(self,[e,selected]);break;}}).focus(function(){qa.results.removeClass('qa_blur');}).blur(function(){setTimeout(function(){qa.results.addClass('qa_blur');},200);});qa.search.keyup();if(s.focus)qa.search.focus();});return this;}});})(jQuery);